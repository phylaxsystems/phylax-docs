---
title: 'Farcaster Unique Username'
description: 'Make sure that a username is unique'
---

## Use Case

Farcaster is a social media platform that allows users to post messages to a decentralized network.
Although it's not a DeFi protocol with a lot of funds at stake, it's still important to make sure that messages are valid and usernames are unique.

It is a basic requirement for a social media platform to make sure that usernames are unique, but if there's a way to circumvent this invariant, it could break the platform.

## Explanation

Check that a username is unique and that the owner of the username is the same as the one who registered it.

## Code Example

```solidity
// SPDX-License-Identifier: MIT
pragma solidity 0.8.28;

import {Assertion} from "../../lib/credible-std/Assertion.sol";

interface IFarcaster {
    function register(string calldata username, address owner) external;
    function isRegistered(string calldata username) external view returns (bool);
    function getUsernameOwner(string calldata username) external view returns (address);
}

contract FarcasterUsernameAssertion is Assertion {
    IFarcaster public farcaster = IFarcaster(address(0xbeef));

    bytes4 constant REGISTER = bytes4(keccak256("register(string,address)"));

    function fnSelectors() external pure override returns (bytes4[] memory assertions) {
        assertions = new bytes4[](1);
        assertions[0] = this.assertUniqueUsername.selector;
    }

    function assertUniqueUsername() external {
        (,,, bytes memory data) = ph.getData();
        bytes4 selector = bytes4(data[:4]);

        if (selector != REGISTER) {
            return;
        }

        // Decode registration parameters
        (string memory username, address owner) = abi.decode(data[4:], (string, address));

        // Check pre-registration state
        ph.forkPreState();
        require(!farcaster.isRegistered(username), "Username already registered");

        // Check post-registration state
        ph.forkPostState();
        require(farcaster.isRegistered(username), "Registration failed");

        require(farcaster.getUsernameOwner(username) == owner, "Owner mismatch");
    }
}

```
